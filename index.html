<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NZ Trip ‚Äî Apr 25 ‚Äì May 3, 2025</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Inter', sans-serif;
  background: #0d1117;
  color: #e6edf3;
  overflow: hidden;
  height: 100vh; height: 100dvh;
}

/* ‚ïê‚ïê HEADER ‚ïê‚ïê */
header {
  position: fixed; top: 0; left: 0; right: 0; height: 56px;
  background: linear-gradient(135deg, #161b22 0%, #1a2332 100%);
  border-bottom: 1px solid #30363d;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 16px; z-index: 1000;
}
.header-title { display: flex; align-items: center; gap: 8px; min-width: 0; flex: 1; }
.nz-flag { font-size: 20px; flex-shrink: 0; }
.header-title h1 { font-size: 16px; font-weight: 700; color: #58a6ff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.header-title p { font-size: 12px; color: #8b949e; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.header-stats { display: flex; gap: 12px; flex-shrink: 0; }
.stat { text-align: center; }
.stat .val { font-size: 16px; font-weight: 700; color: #58a6ff; line-height: 1.2; }
.stat .lbl { font-size: 10px; color: #8b949e; text-transform: uppercase; letter-spacing: 0.4px; }

/* ‚ïê‚ïê MAP + SIDEBAR BASE ‚ïê‚ïê */
#map { position: fixed; top: 56px; z-index: 1; }
.sidebar { position: fixed; background: #161b22; z-index: 500; overflow: hidden; display: flex; flex-direction: column; }
.sidebar::-webkit-scrollbar { width: 4px; }
.sidebar::-webkit-scrollbar-track { background: #161b22; }
.sidebar::-webkit-scrollbar-thumb { background: #30363d; border-radius: 4px; }

/* ‚ïê‚ïê TAB BAR ‚ïê‚ïê */
.tab-bar {
  display: flex; flex-shrink: 0;
  border-bottom: 1px solid #21262d;
  background: #161b22;
}
.tab-btn {
  flex: 1; padding: 10px 4px; border: none; background: none;
  font-family: 'Inter', sans-serif; font-size: 13px; font-weight: 600;
  color: #8b949e; cursor: pointer; transition: all 0.15s ease;
  border-bottom: 2px solid transparent; margin-bottom: -1px;
  display: flex; align-items: center; justify-content: center; gap: 4px;
}
.tab-btn:hover { color: #c9d1d9; background: rgba(255,255,255,0.03); }
.tab-btn.active { color: #58a6ff; border-bottom-color: #58a6ff; }
.tab-btn.active.t-lodging { color: #3fb950; border-bottom-color: #3fb950; }
.tab-btn.active.t-dining { color: #f0883e; border-bottom-color: #f0883e; }
.tab-btn.active.t-cost { color: #e3b341; border-bottom-color: #e3b341; }

/* ‚ïê‚ïê TAB CONTENT ‚ïê‚ïê */
#tab-content { flex: 1; overflow-y: auto; scrollbar-width: thin; scrollbar-color: #30363d #161b22; }

/* ‚ïê‚ïê DESKTOP ‚ïê‚ïê */
@media (min-width: 641px) {
  .sidebar-handle, .sidebar-toggle-hint { display: none !important; }
  .sidebar { top: 56px; left: 0; bottom: 0; width: 340px; border-right: 1px solid #30363d; }
  #map { left: 340px; right: 0; bottom: 0; }
}

/* ‚ïê‚ïê MOBILE ‚ïê‚ïê */
@media (max-width: 640px) {
  .header-title p { display: none; }
  .stat:nth-child(3), .stat:nth-child(4) { display: none; }
  #map { left: 0; right: 0; bottom: 0; }
  .sidebar {
    bottom: 0; left: 0; right: 0; height: 110px;
    border-top: 1px solid #30363d; border-radius: 18px 18px 0 0;
    transition: height 0.32s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .sidebar.open { height: 74dvh; }
  .sidebar-handle {
    display: flex !important; justify-content: center; padding: 10px 0 4px; cursor: pointer; flex-shrink: 0;
  }
  .sidebar-handle::before {
    content: ''; width: 36px; height: 4px; background: #484f58; border-radius: 2px; display: block;
  }
  .tab-btn {
    font-size: 13px;
    padding: 14px 4px;
    gap: 6px;
    flex-direction: column;
  }
  .tab-btn .tab-icon { font-size: 22px; }
  .tab-btn .tab-label { font-size: 13px; font-weight: 600; }
  .sidebar-toggle-hint { display: none; }
}

/* ‚ïê‚ïê SECTION HEADER ‚ïê‚ïê */
.section-header {
  padding: 14px 20px 10px; font-size: 12px; font-weight: 700;
  color: #8b949e; text-transform: uppercase; letter-spacing: 1px;
  border-bottom: 1px solid #21262d; background: #0d1117;
  position: sticky; top: 0; z-index: 10;
  display: flex; align-items: center; justify-content: space-between;
}
.section-header .updated-tag {
  font-size: 10px; font-weight: 500; text-transform: none; letter-spacing: 0;
  color: #484f58; background: rgba(255,255,255,0.04); border: 1px solid #21262d;
  border-radius: 8px; padding: 2px 8px;
}

/* ‚ïê‚ïê STATUS BADGES ‚ïê‚ïê */
.status-badge {
  display: inline-flex; align-items: center; gap: 4px;
  border-radius: 10px; padding: 3px 10px; font-size: 12px; font-weight: 600;
  margin-bottom: 8px;
}
.status-badge.booked {
  background: rgba(63,185,80,0.14); border: 1px solid rgba(63,185,80,0.35); color: #3fb950;
}
.status-badge.deciding {
  background: rgba(227,179,65,0.10); border: 1px solid rgba(227,179,65,0.28); color: #e3b341;
}
.status-badge.backup {
  background: rgba(139,148,158,0.08); border: 1px solid rgba(139,148,158,0.20); color: #6e7681;
}

/* ‚ïê‚ïê DAY CARDS (Itinerary) ‚ïê‚ïê */
.day-card {
  border-bottom: 1px solid #21262d; cursor: pointer;
  transition: background 0.15s ease; position: relative;
}
.day-card:hover { background: #1c2128; }
.day-card.active { background: #1c2128; border-left: 3px solid var(--day-color); }
.day-header { padding: 12px 20px 8px; display: flex; align-items: flex-start; gap: 12px; }
.day-badge {
  width: 34px; height: 34px; border-radius: 50%; background: var(--day-color);
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; font-weight: 700; color: #fff; flex-shrink: 0; box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
.day-meta { flex: 1; }
.day-label { font-size: 15px; font-weight: 600; color: #e6edf3; line-height: 1.3; }
.day-date { font-size: 13px; color: #8b949e; margin-top: 1px; }
.day-location { font-size: 14px; font-weight: 500; color: var(--day-color); margin-top: 2px; }
.day-activities { padding: 0 20px 12px 66px; }
.activity { display: flex; align-items: flex-start; gap: 8px; padding: 3px 0; font-size: 13px; color: #8b949e; line-height: 1.5; }
.activity .dot { width: 5px; height: 5px; border-radius: 50%; background: var(--day-color); flex-shrink: 0; margin-top: 6px; opacity: 0.7; }
.stay-tag {
  display: inline-flex; align-items: center; gap: 4px;
  background: rgba(88,166,255,0.1); border: 1px solid rgba(88,166,255,0.2);
  border-radius: 12px; padding: 4px 10px; font-size: 12px; color: #79c0ff; margin-top: 6px;
}
.vibes-pill {
  display: inline-flex; align-items: center; gap: 4px;
  background: rgba(255,255,255,0.05); border-radius: 10px; padding: 4px 10px;
  font-size: 12px; color: #c9d1d9; margin-top: 4px; font-style: italic;
}

/* ‚ïê‚ïê LOCATION GROUP CARD (Lodging + Dining) ‚ïê‚ïê */
.location-group { border-bottom: 1px solid #21262d; }
.location-group-header {
  padding: 12px 20px 10px; display: flex; align-items: center; gap: 10px;
  background: #0f1318;
}
.location-dot {
  width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0;
}
.location-group-name { font-size: 15px; font-weight: 700; color: #e6edf3; }
.location-group-days { font-size: 12px; color: #8b949e; margin-top: 1px; }

/* ‚ïê‚ïê LODGING CARD ‚ïê‚ïê */
.lodging-card {
  margin: 0 16px 12px; padding: 12px 14px;
  background: #1c2128; border: 1px solid #30363d; border-radius: 10px;
  transition: border-color 0.15s ease;
}
.lodging-card:first-of-type { margin-top: 12px; }
.lodging-card:hover { border-color: #3fb950; }
.lodging-card.is-booked { border-color: rgba(63,185,80,0.4); }
.lodging-name { font-size: 15px; font-weight: 600; color: #e6edf3; margin-bottom: 5px; }
.lodging-meta { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
.lodging-type {
  font-size: 12px; font-weight: 500; color: #3fb950;
  background: rgba(63,185,80,0.1); border: 1px solid rgba(63,185,80,0.2);
  border-radius: 8px; padding: 3px 8px;
}
.lodging-price { font-size: 13px; color: #f0883e; font-weight: 600; }
.lodging-cost {
  display: flex; align-items: baseline; gap: 8px; margin-bottom: 10px;
  background: rgba(63,185,80,0.07); border: 1px solid rgba(63,185,80,0.15);
  border-radius: 8px; padding: 8px 12px;
}
.cost-amount { font-size: 16px; font-weight: 700; color: #3fb950; }
.cost-detail { font-size: 12px; color: #8b949e; }
.lodging-note { font-size: 13px; color: #8b949e; line-height: 1.5; margin-bottom: 10px; }

/* ‚ïê‚ïê DINING CARD ‚ïê‚ïê */
.dining-card {
  margin: 0 16px 12px; padding: 12px 14px;
  background: #1c2128; border: 1px solid #30363d; border-radius: 10px;
  transition: border-color 0.15s ease;
}
.dining-card:first-of-type { margin-top: 12px; }
.dining-card:hover { border-color: #f0883e; }
.dining-card.is-booked { border-color: rgba(240,136,62,0.4); }
.dining-name { font-size: 15px; font-weight: 600; color: #e6edf3; margin-bottom: 5px; }
.dining-meta { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; flex-wrap: wrap; }
.dining-type {
  font-size: 12px; font-weight: 500; color: #f0883e;
  background: rgba(240,136,62,0.1); border: 1px solid rgba(240,136,62,0.2);
  border-radius: 8px; padding: 3px 8px;
}
.dining-dish {
  font-size: 13px; color: #c9d1d9; margin-bottom: 6px;
  display: flex; align-items: flex-start; gap: 5px; line-height: 1.5;
}
.dining-dish::before { content: 'üç¥'; font-size: 12px; flex-shrink: 0; margin-top: 1px; }
.dining-vibe { font-size: 13px; color: #8b949e; font-style: italic; line-height: 1.5; margin-bottom: 10px; }
.dining-rating {
  font-size: 12px; font-weight: 600; color: #f0883e;
  background: rgba(240,136,62,0.1); border: 1px solid rgba(240,136,62,0.25);
  border-radius: 8px; padding: 3px 8px;
}

/* ‚ïê‚ïê CARD ACTION BUTTONS ‚ïê‚ïê */
.card-actions { display: flex; gap: 8px; margin-top: 2px; }
.card-btn {
  flex: 1; padding: 9px 10px; border-radius: 8px; border: 1px solid #30363d;
  font-family: 'Inter', sans-serif; font-size: 13px; font-weight: 600;
  cursor: pointer; text-decoration: none; text-align: center;
  display: flex; align-items: center; justify-content: center; gap: 5px;
  transition: all 0.15s ease; background: #0d1117; color: #c9d1d9;
}
.card-btn:hover { border-color: #58a6ff; color: #58a6ff; background: rgba(88,166,255,0.08); }
.card-btn.book { border-color: rgba(63,185,80,0.4); color: #3fb950; background: rgba(63,185,80,0.06); }
.card-btn.book:hover { border-color: #3fb950; background: rgba(63,185,80,0.12); }
.card-btn.maps { border-color: rgba(88,166,255,0.3); color: #79c0ff; background: rgba(88,166,255,0.06); }
.card-btn.maps:hover { border-color: #58a6ff; background: rgba(88,166,255,0.12); }

/* ‚ïê‚ïê POPUP STYLES ‚ïê‚ïê */
.leaflet-popup-content-wrapper {
  background: #161b22 !important; border: 1px solid #30363d !important;
  border-radius: 12px !important; box-shadow: 0 8px 32px rgba(0,0,0,0.5) !important; padding: 0 !important;
}
.leaflet-popup-content { margin: 0 !important; min-width: 240px; }
.leaflet-popup-tip-container { display: none; }
.leaflet-popup-close-button { color: #8b949e !important; top: 8px !important; right: 8px !important; font-size: 18px !important; }
.popup-inner { padding: 16px 18px 14px; }
.popup-badge {
  display: inline-flex; align-items: center; gap: 6px;
  background: var(--popup-color); border-radius: 20px; padding: 5px 12px;
  font-size: 12px; font-weight: 600; color: #fff; margin-bottom: 10px;
}
.popup-title { font-size: 17px; font-weight: 700; color: #e6edf3; margin-bottom: 10px; line-height: 1.3; }
.popup-items { list-style: none; display: flex; flex-direction: column; gap: 6px; }
.popup-items li { display: flex; align-items: flex-start; gap: 7px; font-size: 13px; color: #8b949e; line-height: 1.5; }
.popup-items li::before { content: '‚Üí'; color: var(--popup-color); font-size: 11px; margin-top: 2px; flex-shrink: 0; }
.popup-footer { margin-top: 10px; padding-top: 10px; border-top: 1px solid #21262d; font-size: 13px; color: #79c0ff; }
.popup-photo-wrap { position: relative; margin: -16px -18px 12px; border-radius: 12px 12px 0 0; overflow: hidden; height: 140px; }
.popup-photo-wrap img { width: 100%; height: 100%; object-fit: cover; display: block; filter: brightness(0.75); }
.popup-meme-overlay {
  position: absolute; bottom: 0; left: 0; right: 0;
  background: linear-gradient(transparent, rgba(0,0,0,0.85));
  padding: 20px 12px 10px; font-size: 13px; font-weight: 600; color: #fff; line-height: 1.4; font-style: italic;
}
.drive-badge {
  background: rgba(255,255,255,0.06); border: 1px solid #30363d; border-radius: 8px;
  padding: 8px 12px; font-size: 13px; color: #8b949e; margin-bottom: 8px;
  display: flex; align-items: center; gap: 5px;
}

/* ‚ïê‚ïê LEGEND ‚ïê‚ïê */
.legend {
  background: rgba(22,27,34,0.95); border: 1px solid #30363d; border-radius: 10px;
  padding: 12px 14px; backdrop-filter: blur(10px);
}
.legend-title { font-size: 12px; font-weight: 600; color: #8b949e; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
.legend-item { display: flex; align-items: center; gap: 8px; font-size: 13px; color: #c9d1d9; margin-bottom: 5px; }
.legend-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }

/* ‚ïê‚ïê MARKERS ‚ïê‚ïê */
.custom-marker {
  display: flex; align-items: center; justify-content: center; border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.3); font-weight: 700; color: white; font-size: 12px;
  box-shadow: 0 3px 12px rgba(0,0,0,0.5); cursor: pointer; transition: transform 0.2s;
}
.custom-marker:hover { transform: scale(1.15); }
.route-label {
  background: rgba(22,27,34,0.9); border: 1px solid #30363d; border-radius: 8px;
  padding: 2px 7px; font-size: 10px; color: #8b949e; white-space: nowrap;
}
.card-carousel{position:relative;width:100%;height:200px;overflow:hidden;border-radius:10px 10px 0 0;background:#0d1117;flex-shrink:0}
.carousel-track{display:flex;height:100%;transition:transform .3s ease;will-change:transform}
.carousel-slide{min-width:100%;height:100%;flex-shrink:0}
.carousel-slide img{width:100%;height:100%;object-fit:cover;display:block;filter:brightness(.85)}
.carousel-dots{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);display:flex;gap:5px;z-index:2}
.carousel-dot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.35);cursor:pointer;transition:background .2s;border:none;padding:0}
.carousel-dot.active{background:#fff}
.carousel-arrow{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.55);border:none;color:#fff;font-size:18px;width:30px;height:30px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:2;opacity:0;transition:opacity .2s;line-height:1}
.card-carousel:hover .carousel-arrow{opacity:1}
.carousel-arrow.prev{left:8px}
.carousel-arrow.next{right:8px}
@media(max-width:640px){.card-carousel{height:180px}.carousel-arrow{display:none!important}}
.lodging-card,.dining-card,.day-card{overflow:hidden}

/* ‚ïê‚ïê COST TAB ‚ïê‚ïê */
.cost-overview { padding: 16px 20px 0; }
.cost-total-card { background: linear-gradient(135deg, rgba(63,185,80,0.1), rgba(88,166,255,0.06)); border: 1px solid rgba(63,185,80,0.3); border-radius: 12px; padding: 16px; text-align: center; margin-bottom: 12px; }
.cost-total-label { font-size: 11px; color: #8b949e; text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 4px; }
.cost-total-amount { font-size: 34px; font-weight: 800; color: #3fb950; letter-spacing: -1px; line-height: 1.1; }
.cost-total-nights { font-size: 13px; color: #8b949e; margin-top: 4px; }
.cost-range { display: flex; gap: 8px; margin-bottom: 16px; }
.cost-range-item { flex: 1; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px; border: 1px solid #21262d; text-align: center; }
.cost-range-item .r-label { font-size: 10px; color: #6e7681; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; }
.cost-range-item .r-val { font-size: 13px; font-weight: 700; color: #8b949e; }
.cost-leg { border-bottom: 1px solid #21262d; }
.cost-leg-header { padding: 12px 20px 6px; display: flex; align-items: center; justify-content: space-between; background: #0f1318; }
.cost-leg-left { display: flex; align-items: center; gap: 8px; }
.cost-leg-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
.cost-leg-name { font-size: 14px; font-weight: 700; color: #e6edf3; }
.cost-leg-nights-tag { font-size: 11px; color: #8b949e; background: rgba(255,255,255,0.05); border: 1px solid #21262d; border-radius: 6px; padding: 2px 6px; }
.cost-leg-subtotal { font-size: 15px; font-weight: 700; color: #3fb950; }
.cost-option { margin: 0 16px 8px; padding: 11px 13px; background: #1c2128; border: 1.5px solid #30363d; border-radius: 10px; cursor: pointer; transition: all 0.15s; }
.cost-option:first-of-type { margin-top: 10px; }
.cost-option:last-of-type { margin-bottom: 12px; }
.cost-option:hover { border-color: rgba(63,185,80,0.5); }
.cost-option.selected { border-color: #3fb950; background: rgba(63,185,80,0.06); }
.cost-option-row { display: flex; align-items: center; gap: 10px; }
.cost-opt-radio { width: 16px; height: 16px; border-radius: 50%; border: 2px solid #484f58; flex-shrink: 0; position: relative; }
.cost-option.selected .cost-opt-radio { border-color: #3fb950; background: #3fb950; }
.cost-option.selected .cost-opt-radio::after { content:''; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:6px; height:6px; border-radius:50%; background:#fff; }
.cost-opt-name { font-size: 13px; font-weight: 600; color: #e6edf3; flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.cost-opt-ppn { font-size: 13px; font-weight: 700; color: #e3b341; flex-shrink: 0; }
.cost-opt-total { font-size: 12px; color: #8b949e; padding-left: 26px; margin-top: 3px; }
.cost-opt-beds { display: inline-flex; align-items: center; gap: 3px; font-size: 11px; color: #79c0ff; background: rgba(88,166,255,0.08); border: 1px solid rgba(88,166,255,0.15); border-radius: 5px; padding: 1px 6px; margin-left: 6px; }
</style>
</head>
<body>

<header>
  <div class="header-title">
    <span class="nz-flag">üá≥üáø</span>
    <div>
      <h1>South Island Road Trip</h1>
      <p>Christchurch ‚Üí Lake Tekapo ‚Üí Mt Cook ‚Üí Queenstown</p>
    </div>
  </div>
  <div class="header-stats">
    <div class="stat"><div class="val">9</div><div class="lbl">Days</div></div>
    <div class="stat"><div class="val">6</div><div class="lbl">Pax</div></div>
    <div class="stat"><div class="val">Apr 25</div><div class="lbl">Depart</div></div>
    <div class="stat"><div class="val">May 3</div><div class="lbl">Return</div></div>
  </div>
</header>

<div id="map"></div>

<div class="sidebar" id="sidebar">
  <div class="sidebar-handle" id="sidebar-handle"></div>
  <div class="tab-bar" id="tab-bar">
    <button class="tab-btn active t-itinerary" data-tab="itinerary"><span class="tab-icon">üìç</span><span class="tab-label">Itinerary</span></button>
    <button class="tab-btn t-lodging" data-tab="lodging"><span class="tab-icon">üè†</span><span class="tab-label">Lodging</span></button>
    <button class="tab-btn t-dining" data-tab="dining"><span class="tab-icon">üçΩÔ∏è</span><span class="tab-label">Dining</span></button>
    <button class="tab-btn t-cost" data-tab="cost"><span class="tab-icon">üí∞</span><span class="tab-label">Cost</span></button>
  </div>
  <div id="tab-content"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const LAST_UPDATED = "Feb 25, 2026 ‚Äî lodging updated with real options";

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const days = [
  {
    id: 1, label: "D1 (Sat)", date: "Apr 25", location: "Christchurch",
    locationId: "christchurch", coords: [-43.5321, 172.6362], color: "#58a6ff",
    activities: ["Land AKL/SYD Airport", "Domestic flight to Christchurch"],
    stay: "Christchurch BnB", drive: null,
    photos: ["https://upload.wikimedia.org/wikipedia/commons/b/bd/The_%22Brill%22_Tram_178.New_Regent_St_Christchurch._%2811510530335%29.jpg","https://upload.wikimedia.org/wikipedia/commons/5/54/Christchurch_Botanic_Gardens_-_geograph.org.uk_-_697988.jpg","https://upload.wikimedia.org/wikipedia/commons/e/e4/Christchurch_Art_Gallery_from_the_square.JPG"],
    meme: "\"It's called the Garden City\" üå∏ ...bro we just flew 10 hours",
    vibes: "Tired but excited üò¥‚úàÔ∏è"
  },
  {
    id: 2, label: "D2 (Sun)", date: "Apr 26", location: "Lake Tekapo",
    locationId: "tekapo", coords: [-44.0038, 170.4786], color: "#3fb950",
    activities: ["3 hr drive from Christchurch", "Pit stops: Ashburton, Methven, Geraldine, Rakaia Gorge, Fairlie", "Tour around Lake Tekapo"],
    stay: "BnB Lodge with hot tub üõÅ", drive: "3 hrs from Christchurch",
    photos: ["https://upload.wikimedia.org/wikipedia/commons/6/65/LakeTekapoNov242024_05.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Lake_Tekapo_-_New_Zealand.jpg/1280px-Lake_Tekapo_-_New_Zealand.jpg","https://upload.wikimedia.org/wikipedia/commons/1/18/Lake_Tekapo_and_lupins.jpg"],
    meme: "Sheep spotted count: lost track after 847 üêëüêëüêë",
    vibes: "Road trip mode activated üöóüéµ"
  },
  {
    id: 3, label: "D3 (Mon)", date: "Apr 27", location: "Lake Tekapo",
    locationId: "tekapo", coords: [-44.0038, 170.4786], color: "#3fb950",
    activities: ["Peninsula Walkway / Lakeside Trail", "Lake Alexandrina", "Tekapo Springs"],
    stay: "BnB Lodge with hot tub üõÅ", drive: null,
    photos: ["https://upload.wikimedia.org/wikipedia/commons/5/57/Church_of_the_Good_Shepherd%2C_Tekapo_01.jpg","https://upload.wikimedia.org/wikipedia/commons/6/65/LakeTekapoNov242024_05.jpg","https://upload.wikimedia.org/wikipedia/commons/1/18/Lake_Tekapo_and_lupins.jpg"],
    meme: "The lake is THIS blue in real life. Instagram didn't lie for once üò§",
    vibes: "Main character energy üíÖüèîÔ∏è"
  },
  {
    id: 4, label: "D4 (Tue)", date: "Apr 28", location: "Mt Cook Village",
    locationId: "mtcook", coords: [-43.7359, 170.0966], color: "#f0883e",
    activities: ["1.5 hr drive to Aoraki/Mt Cook Village", "Mt Cook Alpine Salmon Shop", "Picnic next to Lake Pukaki", "Tasman Glacier View Track (1.5km ~40 mins)"],
    stay: "Mt Cook Village BnB", drive: "1.5 hrs from Lake Tekapo",
    photos: ["https://upload.wikimedia.org/wikipedia/commons/0/08/LakePukakiNov232024_01.jpg","https://upload.wikimedia.org/wikipedia/commons/f/f6/Aoraki_Mount_Cook_-_from_the_south.jpg","https://upload.wikimedia.org/wikipedia/commons/4/44/Tasman_Glacier.jpg"],
    meme: "One does not simply walk into Mt Cook... actually you can. There are signs. üßô‚Äç‚ôÇÔ∏è",
    vibes: "Full Tolkien mode üèîÔ∏èüíç"
  },
  {
    id: 5, label: "D5 (Wed)", date: "Apr 29", location: "Mt Cook Village",
    locationId: "mtcook", coords: [-43.7359, 170.0966], color: "#f0883e",
    activities: ["Hooker Valley Track (3‚Äì4 hrs, flat road)", "or Kea Point Track (3km ~2 hrs, stairs)", "Glentanner Park / Aoraki Alpine Lodge", "Outdoor BBQ picnic"],
    stay: "Mt Cook Village BnB", drive: null,
    photos: ["https://upload.wikimedia.org/wikipedia/commons/2/23/Stocking_Stream_Shelter_in_Hooker_Valley_in_front_of_Aoraki_Mount_Cook_Range.jpg","https://upload.wikimedia.org/wikipedia/commons/1/10/Hooker_Lake_and_Aoraki.jpg","https://upload.wikimedia.org/wikipedia/commons/f/f6/Aoraki_Mount_Cook_-_from_the_south.jpg"],
    meme: "\"It's flat, easy walking\" they said üòÆ‚Äçüí® *dies on the return leg*",
    vibes: "We're hikers now apparently ü•æüòÖ"
  },
  {
    id: 6, label: "D6 (Thu)", date: "Apr 30", location: "Gibbston Valley",
    locationId: "gibbston", coords: [-45.0132, 168.9481], color: "#bc8cff",
    activities: ["2.5 hr drive to Cromwell", "Winery visits in Gibbston Valley"],
    stay: "Winery cottage üç∑", drive: "2.5 hrs from Mt Cook",
    photos: ["https://upload.wikimedia.org/wikipedia/commons/1/1c/Vineyard_in_Gibbston_Valley_in_South_Island%2C_New_Zealand_-_Central_Otago_wine_region.jpg","https://upload.wikimedia.org/wikipedia/commons/4/40/Peregrine_Winery%2C_Gibbston.jpg","https://upload.wikimedia.org/wikipedia/commons/5/5d/Central_Otago_wine_region.jpg"],
    meme: "\"Wine tasting\" = technically drinking before noon. But make it classy üç∑üòá",
    vibes: "Sophisticated degenerates üçá‚ú®"
  },
  {
    id: 7, label: "D7 (Fri)", date: "May 1", location: "Queenstown",
    locationId: "queenstown", coords: [-45.0312, 168.6626], color: "#ff7b72",
    activities: ["Optional: morning winery visit", "1 hr drive to Queenstown"],
    stay: "Queenstown BnB", drive: "~1 hr from Gibbston",
    photos: ["https://upload.wikimedia.org/wikipedia/commons/c/c9/Queenstown_1_%288168013172%29.jpg","https://upload.wikimedia.org/wikipedia/commons/a/a9/Queenstown%2C_New_Zealand.jpg","https://upload.wikimedia.org/wikipedia/commons/2/29/Queenstown_at_night.jpg"],
    meme: "Queenstown: where you plan to bungee jump and end up just eating burgers instead üçî",
    vibes: "Adventure capital... of eating üèîÔ∏èüçî"
  },
  {
    id: 8, label: "D8 (Sat)", date: "May 2", location: "Queenstown",
    locationId: "queenstown", coords: [-45.0312, 168.6626], color: "#ff7b72",
    activities: ["TSS Earnslaw cruise? üö¢", "Explore Queenstown"],
    stay: "Queenstown BnB", drive: null,
    photos: ["https://upload.wikimedia.org/wikipedia/commons/1/19/TSS_Earnslaw.jpg","https://upload.wikimedia.org/wikipedia/commons/c/c9/Queenstown_1_%228168013172%29.jpg","https://upload.wikimedia.org/wikipedia/commons/a/a9/Queenstown%2C_New_Zealand.jpg"],
    meme: "Boarding a 112-year-old steam ship. Peak confidence. No notes. üö¢üî•",
    vibes: "Last full day, maximum chaos üéâ"
  },
  {
    id: 9, label: "D9 (Sun)", date: "May 3", location: "Depart",
    locationId: "queenstown", coords: [-45.0312, 168.6626], color: "#8b949e",
    activities: ["Depart to AKL/SYD Airport", "Transit to HKG üè†"],
    stay: null, drive: null,
    photos: ["https://upload.wikimedia.org/wikipedia/commons/c/c8/Auckland_International_Airport_2017_aerial.png","https://upload.wikimedia.org/wikipedia/commons/1/19/TSS_Earnslaw.jpg","https://upload.wikimedia.org/wikipedia/commons/c/c9/Queenstown_1_%228168013172%29.jpg"],
    meme: "Goodbye NZ üò≠ Hello 12-hour flight and 47 unread emails üíÄ",
    vibes: "Post-trip depression loading... ü•≤"
  }
];

const locations = [
  {
    id: "christchurch", name: "Christchurch", days: [1], nights: 1,
    coords: [-43.5321, 172.6362], color: "#58a6ff",
    lodging: [
      {
        name: "Option 1 ‚Äî Airport Motel",
        type: "Motel ¬∑ Near Airport", price: "$$",
        costPerPP: 535,
        costNote: "HK$535/pp ¬∑ HK$3,210/night", costDetail: "6 pax / 3 beds",
        note: "Close to CHC airport. Simple and practical for arrival night. ‚ö†Ô∏è Only 3 beds ‚Äî 2 people sharing.",
        photos: ["https://upload.wikimedia.org/wikipedia/commons/7/7a/The_George%2C_Christchurch%2C_New_Zealand.jpg","https://upload.wikimedia.org/wikipedia/commons/b/bd/The_%22Brill%22_Tram_178.New_Regent_St_Christchurch._%2811510530335%29.jpg"],
        status: "deciding",
        coords: [-43.4900, 172.5350],
        bookingUrl: "https://www.booking.com/Share-JHf9Ws",
        mapsUrl: "https://maps.google.com/?q=Airport+Christchurch+Motel"
      },
      {
        name: "Option 2 ‚Äî 4-Bed Christchurch Home",
        type: "Airbnb ¬∑ Whole House", price: "$$",
        costPerPP: 605,
        costNote: "HK$605/pp ¬∑ HK$3,630/night", costDetail: "6 pax / 4 beds",
        note: "4 proper beds for 6 pax. Better for the group ‚Äî everyone gets a bed.",
        photos: ["https://a0.muscache.com/im/pictures/hosting/Hosting-1553381294664289544/original/14a53380-d3ef-4b0b-8bcb-bb4c03f6e516.jpeg?aki_policy=large","https://a0.muscache.com/im/pictures/hosting/Hosting-1553381294664289544/original/24432978-cc8f-497f-9174-b80e2682a2b4.jpeg?aki_policy=large","https://a0.muscache.com/im/pictures/hosting/Hosting-1553381294664289544/original/c5c785b5-1104-4793-986f-204d96533e65.jpeg?aki_policy=large","https://a0.muscache.com/im/pictures/hosting/Hosting-1553381294664289544/original/4b79139e-6f3a-4b4d-bada-1515a8863e86.jpeg?aki_policy=large"],
        status: "deciding",
        coords: [-43.5321, 172.6362],
        bookingUrl: "https://www.airbnb.com/rooms/1553381294664289544",
        mapsUrl: "https://maps.google.com/?q=Christchurch+New+Zealand"
      }
    ],
    dining: [
      {
        name: "Hello Sunday",
        type: "All-day brunch caf√©",
        dish: "Smashed avo toast + cold brew",
        vibe: "‚òÄÔ∏è Best brunch spot in CHC ‚Äî lively, packed on weekends",
        photos: ["https://upload.wikimedia.org/wikipedia/commons/5/54/Christchurch_Botanic_Gardens_-_geograph.org.uk_-_697988.jpg","https://upload.wikimedia.org/wikipedia/commons/b/bd/The_%22Brill%22_Tram_178.New_Regent_St_Christchurch._%2811510530335%29.jpg"],
        status: "deciding",
        coords: [-43.5292, 172.6368],
        mapsUrl: "https://maps.google.com/?q=Hello+Sunday+Christchurch+NZ"
      },
      {
        name: "Fiddlesticks",
        type: "Wine bar / restaurant",
        dish: "Local pinot noir + shared boards",
        vibe: "üç∑ Sophisticated but relaxed ‚Äî perfect first-night dinner",
        photos: ["https://fiddlesticksbar.co.nz/wp-content/uploads/2023/10/Fiddlesticks-TC-header.jpg","https://fiddlesticksbar.co.nz/wp-content/uploads/2023/10/home-fiddlesticks-cocktail.jpg","https://fiddlesticksbar.co.nz/wp-content/uploads/2023/10/home-fiddlesticks-coffee.jpg"],
        status: "deciding",
        coords: [-43.5301, 172.6352],
        rating: "4.4",
        bookingUrl: "https://fiddlesticksbar.co.nz/reservations/",
        mapsUrl: "https://maps.google.com/?q=Fiddlesticks+Christchurch+NZ"
      },
      {
        name: "The Pog",
        type: "Gastropub",
        dish: "Burger + whatever's on tap",
        vibe: "üç∫ Chill spot if you just want to decompress after the flight",
        photos: ["https://upload.wikimedia.org/wikipedia/commons/b/bd/The_%22Brill%22_Tram_178.New_Regent_St_Christchurch._%2811510530335%29.jpg","https://upload.wikimedia.org/wikipedia/commons/5/54/Christchurch_Botanic_Gardens_-_geograph.org.uk_-_697988.jpg"],
        status: "deciding",
        coords: [-43.5310, 172.6340],
        mapsUrl: "https://maps.google.com/?q=The+Pog+Christchurch+NZ"
      }
    ]
  },
  {
    id: "tekapo", name: "Lake Tekapo", days: [2, 3], nights: 2,
    coords: [-44.0038, 170.4786], color: "#3fb950",
    lodging: [
      {
        name: "Option 3 ‚Äî Eclipse Haven (Hot Tub) ‚≠ê",
        type: "Airbnb ¬∑ 2BR Studio", price: "$$",
        costPerPP: 463,
        costNote: "HK$463/pp ¬∑ HK$2,778/night", costDetail: "6 pax / 3 beds only ‚ö†Ô∏è",
        note: "Karl's pick üôã Hot tub with lake views. Cozy, unique ‚Äî but only 3 beds for 6 pax, 2 people sharing. Ohana Stays.",
        photos: ["https://assets.guesty.com/image/upload/v1744646241/production/6548291210675435b724622a/sbcjonwsvpkzpey5sdqg.jpg","https://assets.guesty.com/image/upload/v1744646238/production/6548291210675435b724622a/oces5a49n9vgouxws6ck.jpg","https://assets.guesty.com/image/upload/v1717997974/production/6548291210675435b724622a/vprrrxilxx5597yyxqhr.jpg","https://assets.guesty.com/image/upload/v1744698748/production/6548291210675435b724622a/vew41zb8cwbk7mnj6nfx.jpg"],
        status: "deciding",
        coords: [-44.0038, 170.4786],
        bookingUrl: "https://ohanastays.co.nz/stays/eclipse-haven-2br-hot-tub-parking-sleeps-5/",
        mapsUrl: "https://maps.google.com/?q=Lake+Tekapo+New+Zealand"
      },
      {
        name: "Option 4 ‚Äî Puku-hape Holiday Home",
        type: "Holiday Home ¬∑ 4 Beds", price: "$$$",
        costPerPP: 789,
        costNote: "HK$789/pp ¬∑ HK$4,734/night", costDetail: "6 pax / 4 beds ¬∑ no hot tub",
        note: "4 proper beds, everyone sleeps comfortably. No hot tub though. Costs more but solves the beds problem.",
        photos: ["https://upload.wikimedia.org/wikipedia/commons/6/65/LakeTekapoNov242024_05.jpg","https://upload.wikimedia.org/wikipedia/commons/5/57/Church_of_the_Good_Shepherd%2C_Tekapo_01.jpg","https://upload.wikimedia.org/wikipedia/commons/1/18/Lake_Tekapo_and_lupins.jpg"],
        status: "deciding",
        coords: [-44.0068, 170.4820],
        bookingUrl: "https://puku-hape-holiday-home.southislandnz.net/en/",
        mapsUrl: "https://maps.google.com/?q=Puku-hape+Holiday+Home+Lake+Tekapo"
      }
    ],
    dining: [
      {
        name: "Kohan Restaurant",
        type: "Japanese",
        dish: "Salmon sashimi (local Mt Cook salmon ‚Äî seriously)",
        vibe: "üç£ Surprisingly legit Japanese in the middle of NZ's south island",
        photos: ["https://upload.wikimedia.org/wikipedia/commons/6/65/LakeTekapoNov242024_05.jpg","https://upload.wikimedia.org/wikipedia/commons/5/57/Church_of_the_Good_Shepherd%2C_Tekapo_01.jpg"],
        status: "deciding",
        coords: [-44.0031, 170.4789],
        rating: "4.3",
        bookingUrl: "https://www.kohanrestaurant.co.nz/",
        mapsUrl: "https://maps.google.com/?q=Kohan+Restaurant+Lake+Tekapo"
      },
      {
        name: "Mackenzie's Bar & Grill",
        type: "NZ Classic",
        dish: "Lamb rack + Mackenzie Basin pinot",
        vibe: "ü•© Classic NZ cooking, solid every time, lake views",
        photos: ["https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Lake_Tekapo_-_New_Zealand.jpg/1280px-Lake_Tekapo_-_New_Zealand.jpg","https://upload.wikimedia.org/wikipedia/commons/6/65/LakeTekapoNov242024_05.jpg"],
        status: "deciding",
        coords: [-44.0044, 170.4777],
        rating: "4.2",
        bookingUrl: "https://www.peppers.co.nz/bluewater/dining/",
        mapsUrl: "https://maps.google.com/?q=Mackenzies+Bar+Grill+Lake+Tekapo"
      },
      {
        name: "Run 76 Caf√©",
        type: "Caf√©",
        dish: "Flat white + cabinet food",
        vibe: "‚òï Morning fuel before the Peninsula Walkway",
        photos: ["https://upload.wikimedia.org/wikipedia/commons/1/18/Lake_Tekapo_and_lupins.jpg","https://upload.wikimedia.org/wikipedia/commons/6/65/LakeTekapoNov242024_05.jpg"],
        status: "deciding",
        coords: [-44.0022, 170.4801],
        mapsUrl: "https://maps.google.com/?q=Run+76+Cafe+Lake+Tekapo"
      }
    ]
  },
  {
    id: "mtcook", name: "Mt Cook Village", days: [4, 5], nights: 2,
    coords: [-43.7359, 170.0966], color: "#f0883e",
    lodging: [
      {
        name: "Option 5 ‚Äî Glentanner Self-Contained Cabin",
        type: "Cabin ¬∑ Shared Grill", price: "$",
        costPerPP: 478,
        costNote: "HK$478/pp ¬∑ HK$2,868/night", costDetail: "6 pax / 2 beds + 1 sofa bed",
        note: "Right at the base of Aoraki with epic views. Access to shared BBQ grill area. ‚ö†Ô∏è Tight on beds ‚Äî 2 beds + sofa bed for 6.",
        photos: ["https://www.glentanner.co.nz/wp-content/uploads/McLennan_SI_NZ_13_079_cropped.jpg","https://www.glentanner.co.nz/wp-content/uploads/Motel-3-Beds-scaled.jpg","http://www.glentanner.co.nz/wp-content/uploads/Basic-Cabin2.jpg"],
        status: "deciding",
        coords: [-43.8050, 170.1000],
        bookingUrl: "https://www.glentanner.co.nz/self-contained-cabins/",
        mapsUrl: "https://maps.google.com/?q=Glentanner+Park+Centre+Mt+Cook"
      },
      {
        name: "Option 6 ‚Äî Aoraki Court 2BR Unit",
        type: "Self-Contained Unit ¬∑ 4 Beds", price: "$$$",
        costPerPP: 781,
        costNote: "HK$781/pp ¬∑ HK$4,686/night", costDetail: "6 pax / 4 beds",
        note: "4 beds, great Mt Cook Village location. Walking distance to Hooker Valley trailhead + Tasman Glacier road. More comfortable than Glentanner.",
        photos: ["https://aorakicourt.co.nz/wp-content/uploads/2024/09/Two-Bedroom-Unit-View-1.jpg","https://upload.wikimedia.org/wikipedia/commons/9/94/00_1700_Aoraki_Mount_Cook%2CThe_Hermitage_-_Mount-Cook-Nationalpark.jpg","https://upload.wikimedia.org/wikipedia/commons/f/f6/Aoraki_Mount_Cook_-_from_the_south.jpg"],
        status: "deciding",
        coords: [-43.7359, 170.0966],
        bookingUrl: "https://aorakicourt.co.nz/accommodation/2-bedroom-unit/",
        mapsUrl: "https://maps.google.com/?q=Aoraki+Court+Mt+Cook+Village"
      }
    ],
    dining: [
      {
        name: "Old Mountaineers' Caf√©",
        type: "Caf√© / Bar",
        dish: "Venison pie + Speight's Old Dark",
        vibe: "üèîÔ∏è Legendary. Alpine hikers fuel up here. Best views of Aoraki while you eat.",
        photos: ["https://upload.wikimedia.org/wikipedia/commons/f/f6/Aoraki_Mount_Cook_-_from_the_south.jpg","https://upload.wikimedia.org/wikipedia/commons/2/23/Stocking_Stream_Shelter_in_Hooker_Valley_in_front_of_Aoraki_Mount_Cook_Range.jpg"],
        status: "deciding",
        coords: [-43.7355, 170.0972],
        rating: "4.6",
        bookingUrl: "https://www.oldmountaineers.co.nz/",
        mapsUrl: "https://maps.google.com/?q=Old+Mountaineers+Cafe+Mt+Cook+Village"
      },
      {
        name: "Panorama Restaurant",
        type: "Fine dining",
        dish: "Set degustation menu with mountain views",
        vibe: "‚ú® Splurge night ‚Äî floor-to-ceiling windows facing Aoraki. Worth it once.",
        photos: ["https://upload.wikimedia.org/wikipedia/commons/8/8d/The_Hermitage_hotel%2C_Mount_Cook%2C_New_Zealand_-_panoramio.jpg","https://upload.wikimedia.org/wikipedia/commons/f/f6/Aoraki_Mount_Cook_-_from_the_south.jpg"],
        status: "deciding",
        coords: [-43.7361, 170.0960],
        rating: "4.1",
        bookingUrl: "https://www.hermitage.co.nz/dining/panorama-restaurant/",
        mapsUrl: "https://maps.google.com/?q=Panorama+Restaurant+Hermitage+Mt+Cook"
      }
    ]
  },
  {
    id: "gibbston", name: "Central Otago", days: [6], nights: 1,
    coords: [-45.0132, 168.9481], color: "#bc8cff",
    lodging: [
      {
        name: "Option 7 ‚Äî Carrick Winery, Towan Cottage",
        type: "Winery Stay ¬∑ 3BR", price: "$$$",
        costPerPP: 582,
        costNote: "HK$582/pp ¬∑ HK$3,492/night", costDetail: "6 pax / 3 bedrooms ¬∑ inside winery",
        note: "Sleep literally inside a working winery in Bannockburn. 3BR cottage surrounded by vines. Cellar door on-site. The most unique stay of the trip.",
        photos: ["https://www.carrick.co.nz/workspace/uploads/towan/towan-1.jpg","https://www.carrick.co.nz/workspace/uploads/towan-bedroom-900x900.jpg","https://www.carrick.co.nz/workspace/uploads/towan-entrance-900x900.jpg","https://www.carrick.co.nz/workspace/uploads/towan-landscape-1244x650.jpg"],
        status: "deciding",
        coords: [-44.9766, 169.2247],
        bookingUrl: "https://www.carrick.co.nz/accommodation/",
        mapsUrl: "https://maps.google.com/?q=Carrick+Winery+Bannockburn+Cromwell"
      },
      {
        name: "Option 8 ‚Äî Central Otago Airbnb (4 beds)",
        type: "Airbnb ¬∑ 4 Beds", price: "$$",
        costPerPP: 632,
        costNote: "HK$632/pp ¬∑ HK$3,792/night", costDetail: "6 pax / 4 beds ¬∑ not inside winery",
        note: "Not inside a winery but solid 4-bed option in the Central Otago area.",
        photos: ["https://a0.muscache.com/im/pictures/prohost-api/Hosting-1011740576663789724/original/c4368001-5a58-461e-89de-46b4db4dff1e.jpeg?aki_policy=large","https://a0.muscache.com/im/pictures/prohost-api/Hosting-1011740576663789724/original/07f7136c-094e-4ad6-9641-5f4c546b326a.jpeg?aki_policy=large","https://a0.muscache.com/im/pictures/prohost-api/Hosting-1011740576663789724/original/192b34d2-573e-4ee2-9109-dce18b9fc15b.jpeg?aki_policy=large","https://a0.muscache.com/im/pictures/prohost-api/Hosting-1011740576663789724/original/499b0e58-c465-4315-bf6d-1b8846d45172.jpeg?aki_policy=large"],
        status: "deciding",
        coords: [-45.0180, 168.9600],
        bookingUrl: "https://www.airbnb.com/rooms/1011740576663789724",
        mapsUrl: "https://maps.google.com/?q=Central+Otago+New+Zealand"
      },
      {
        name: "Option 9 ‚Äî Central Otago Airbnb (5 beds)",
        type: "Airbnb ¬∑ 5 Beds", price: "$$",
        costPerPP: 526,
        costNote: "HK$526/pp ¬∑ HK$3,156/night", costDetail: "6 pax / 5 beds ¬∑ not inside winery",
        note: "Best bed ratio of the Central Otago options. 5 beds for 6 pax ‚Äî almost everyone gets their own. Not inside a winery.",
        photos: ["https://a0.muscache.com/im/pictures/94b84470-21bb-4282-8346-2889fad1b974.jpg?aki_policy=large","https://a0.muscache.com/im/pictures/d3892b55-092b-4e5b-a80b-728b6986d42e.jpg?aki_policy=large","https://a0.muscache.com/im/pictures/410e181d-ea7a-4510-b5e3-84df985b32a6.jpg?aki_policy=large","https://a0.muscache.com/im/pictures/c0994f2a-aa48-45f8-b13d-5c847681d273.jpg?aki_policy=large"],
        status: "deciding",
        coords: [-45.0250, 168.9400],
        bookingUrl: "https://www.airbnb.com/rooms/47093536",
        mapsUrl: "https://maps.google.com/?q=Central+Otago+New+Zealand"
      }
    ],
    dining: [
      {
        name: "Amisfield Bistro",
        type: "Farm-to-table fine dining",
        dish: "'Trust the chef' menu ‚Äî no menu, all seasonal",
        vibe: "üåø One of NZ's best restaurants. Seriously. Book ahead.",
        photos: ["https://amisfield.co.nz/cdn/shop/files/Atmos_DSC00593_85_1c41c372-0b26-4db6-b8fb-a0a9aa5f7288_1.jpg","https://upload.wikimedia.org/wikipedia/commons/4/40/Peregrine_Winery%2C_Gibbston.jpg"],
        status: "deciding",
        coords: [-44.9890, 168.8950],
        rating: "4.6",
        bookingUrl: "https://amisfield.co.nz/dining/",
        mapsUrl: "https://maps.google.com/?q=Amisfield+Bistro+Queenstown"
      },
      {
        name: "Peregrine Wines",
        type: "Cellar door tasting",
        dish: "Pinot Noir flight + cheese board",
        vibe: "üç∑ Iconic NZ modernist architecture + award-winning wine",
        photos: ["https://upload.wikimedia.org/wikipedia/commons/4/40/Peregrine_Winery%2C_Gibbston.jpg","https://upload.wikimedia.org/wikipedia/commons/5/5d/Central_Otago_wine_region.jpg"],
        status: "deciding",
        coords: [-45.0035, 168.9200],
        mapsUrl: "https://maps.google.com/?q=Peregrine+Wines+Gibbston+Valley"
      },
      {
        name: "Kinross Cellar Door & Kitchen",
        type: "Wine bar",
        dish: "Pinot Gris + shared plates",
        vibe: "üçá Relaxed, unpretentious tasting right in the valley",
        photos: ["https://kinross.nz/cdn/shop/files/blue_sky_cellar_door.jpg","https://upload.wikimedia.org/wikipedia/commons/1/1c/Vineyard_in_Gibbston_Valley_in_South_Island%2C_New_Zealand_-_Central_Otago_wine_region.jpg"],
        status: "deciding",
        coords: [-45.0120, 168.9450],
        mapsUrl: "https://maps.google.com/?q=Kinross+Cellar+Door+Gibbston"
      }
    ]
  },
  {
    id: "queenstown", name: "Queenstown", days: [7, 8, 9], nights: 2,
    coords: [-45.0312, 168.6626], color: "#ff7b72",
    lodging: [
      {
        name: "Option 10 ‚Äî Queenstown Airbnb (5 beds)",
        type: "Airbnb ¬∑ 5 Beds", price: "$$",
        costPerPP: 599,
        costNote: "HK$599/pp ¬∑ HK$3,594/night", costDetail: "6 pax / 5 beds",
        note: "5 beds for 6 pax. Solid Queenstown base.",
        photos: ["https://a0.muscache.com/im/pictures/7f638743-4054-4ef0-8c3f-d9f9133845d0.jpg?aki_policy=large","https://a0.muscache.com/im/pictures/52d9f81a-1c81-44c5-9b4d-a8034954205e.jpg?aki_policy=large","https://a0.muscache.com/im/pictures/19714285-0747-4109-995d-fb503ab5f2bf.jpg?aki_policy=large","https://a0.muscache.com/im/pictures/miso/Hosting-33571005/original/02fa8f16-704a-4fef-af39-68755b0bbada.jpeg?aki_policy=large"],
        status: "deciding",
        coords: [-45.0280, 168.6550],
        bookingUrl: "https://www.airbnb.com/rooms/33571005",
        mapsUrl: "https://maps.google.com/?q=Queenstown+New+Zealand"
      },
      {
        name: "Option 11 ‚Äî Queenstown Airbnb (5 beds) #2",
        type: "Airbnb ¬∑ 5 Beds", price: "$$",
        costPerPP: 621,
        costNote: "HK$621/pp ¬∑ HK$3,726/night", costDetail: "6 pax / 5 beds",
        note: "Another 5-bed option. Slightly pricier than #10.",
        photos: ["https://a0.muscache.com/im/pictures/hosting/Hosting-1514170091372902919/original/927d7875-ed28-44f1-9b66-db52a93be73e.jpeg?aki_policy=large","https://a0.muscache.com/im/pictures/hosting/Hosting-1514170091372902919/original/17a3a559-38ab-421e-818c-6c6dd7564416.jpeg?aki_policy=large","https://a0.muscache.com/im/pictures/hosting/Hosting-1514170091372902919/original/5ce99f71-70e6-481d-bab8-ed0e349474a3.jpeg?aki_policy=large","https://a0.muscache.com/im/pictures/prohost-api/Hosting-1514170091372902919/original/3acc16c1-62d6-4a03-b29b-4f35de9d9a50.jpeg?aki_policy=large"],
        status: "deciding",
        coords: [-45.0330, 168.6670],
        bookingUrl: "https://www.airbnb.com/rooms/1514170091372902919",
        mapsUrl: "https://maps.google.com/?q=Queenstown+New+Zealand"
      },
      {
        name: "Option 12 ‚Äî Downtown Queenstown (5 beds)",
        type: "Airbnb ¬∑ 5 Beds ¬∑ Downtown", price: "$$$",
        costPerPP: 669,
        costNote: "HK$669/pp ¬∑ HK$4,014/night", costDetail: "6 pax / 5 beds ¬∑ closest to town",
        note: "Most expensive but closest to Queenstown downtown. Walk to Fergburger, lakefront, restaurants ‚Äî no Uber needed.",
        photos: ["https://a0.muscache.com/im/pictures/d7beae0d-7e9f-4362-bd46-811672667ea9.jpg?aki_policy=large","https://a0.muscache.com/im/pictures/6d9ad352-b345-44fe-ba81-ce4ff6190204.jpg?aki_policy=large","https://a0.muscache.com/im/pictures/f589240e-1596-4d17-8e00-eaeba137039d.jpg?aki_policy=large","https://a0.muscache.com/im/pictures/cd62d062-2e45-4e23-85e6-e85be443b945.jpg?aki_policy=large"],
        status: "deciding",
        coords: [-45.0312, 168.6626],
        bookingUrl: "https://www.airbnb.com/rooms/30745001",
        mapsUrl: "https://maps.google.com/?q=Queenstown+CBD+New+Zealand"
      }
    ],
    dining: [
      {
        name: "Fergburger",
        type: "Legendary burger joint",
        dish: "The Ferg (double beef) ‚Äî no modifications",
        vibe: "üçî Non-negotiable. Queue is part of the experience. Open till 5am.",
        photos: ["https://upload.wikimedia.org/wikipedia/commons/5/55/Fergburger_restaurant.jpg","https://upload.wikimedia.org/wikipedia/commons/e/e8/Fergburger_714.jpg"],
        status: "deciding",
        coords: [-45.0315, 168.6628],
        mapsUrl: "https://maps.google.com/?q=Fergburger+Queenstown"
      },
      {
        name: "Rata",
        type: "Fine dining NZ",
        dish: "Venison + Central Otago pinot pairing",
        vibe: "‚ú® Josh Emett's restaurant. Serious food, serious wine list.",
        photos: ["https://upload.wikimedia.org/wikipedia/commons/2/29/Queenstown_at_night.jpg","https://upload.wikimedia.org/wikipedia/commons/a/a9/Queenstown%2C_New_Zealand.jpg"],
        status: "deciding",
        coords: [-45.0308, 168.6601],
        rating: "4.5",
        bookingUrl: "https://ratadining.co.nz/",
        mapsUrl: "https://maps.google.com/?q=Rata+Restaurant+Queenstown"
      },
      {
        name: "Botswana Butchery",
        type: "Steakhouse",
        dish: "Eye fillet with lake view",
        vibe: "ü•© Power dinner vibes. Lakefront terrace. Dress up slightly.",
        photos: ["https://botswanabutchery.nz/wp-content/uploads/2016/12/Botswana_Web_Intro-20Dec16-D1b_04.jpg","https://botswanabutchery.nz/wp-content/uploads/2016/12/Botswana_Web_Intro-20Dec16-D1b_06.jpg"],
        status: "deciding",
        coords: [-45.0301, 168.6589],
        rating: "4.4",
        bookingUrl: "https://botswanabutchery.nz/queenstown/",
        mapsUrl: "https://maps.google.com/?q=Botswana+Butchery+Queenstown"
      }
    ]
  }
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function statusBadge(status) {
  const map = {
    booked:   { cls: 'booked',   label: '‚úÖ Booked' },
    deciding: { cls: 'deciding', label: 'üó≥Ô∏è Deciding' },
    backup:   { cls: 'backup',   label: '¬∑ Backup' }
  };
  const s = map[status] || map.deciding;
  return `<div class="status-badge ${s.cls}">${s.label}</div>`;
}

function carouselHTML(photos,alt){if(!photos||!photos.length)return"";const id="c"+Math.random().toString(36).slice(2,7);if(photos.length===1)return`<div class="card-carousel" id="${id}"><div class="carousel-track"><div class="carousel-slide"><img src="${photos[0]}" alt="${alt}" loading="lazy"/></div></div></div>`;const slides=photos.map(p=>`<div class="carousel-slide"><img src="${p}" alt="${alt}" loading="lazy"/></div>`).join("");const dots=photos.map((_,i)=>`<button class="carousel-dot${i===0?" active":""}" data-c="${id}" data-i="${i}"></button>`).join("");return`<div class="card-carousel" id="${id}"><div class="carousel-track">${slides}</div><div class="carousel-dots">${dots}</div><button class="carousel-arrow prev" data-c="${id}">&#x2039;</button><button class="carousel-arrow next" data-c="${id}">&#x203a;</button></div>`;}
const _cs={};
function initCarousels(){document.querySelectorAll(".card-carousel").forEach(el=>{const id=el.id;if(!id||_cs[id])return;const track=el.querySelector(".carousel-track");if(!track)return;const total=track.children.length;if(total<=1)return;_cs[id]={cur:0,total};function go(idx){const s=_cs[id];s.cur=(idx+s.total)%s.total;track.style.transform=`translateX(-${s.cur*100}%)`;el.querySelectorAll(".carousel-dot").forEach((d,i)=>d.classList.toggle("active",i===s.cur));}el.querySelectorAll(".carousel-arrow.prev").forEach(b=>b.addEventListener("click",e=>{e.stopPropagation();go(_cs[id].cur-1);}));el.querySelectorAll(".carousel-arrow.next").forEach(b=>b.addEventListener("click",e=>{e.stopPropagation();go(_cs[id].cur+1);}));el.querySelectorAll(".carousel-dot").forEach((d,i)=>d.addEventListener("click",e=>{e.stopPropagation();go(i);}));let tx=0;el.addEventListener("touchstart",e=>{tx=e.touches[0].clientX;},{passive:true});el.addEventListener("touchend",e=>{const dx=e.changedTouches[0].clientX-tx;if(Math.abs(dx)>40)go(_cs[id].cur+(dx<0?1:-1));},{passive:true});});}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAP SETUP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const map = L.map('map', { center: [-44.2, 170.5], zoom: 7, zoomControl: false });
L.control.zoom({ position: 'topright' }).addTo(map);

L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
  attribution: '¬© OpenStreetMap contributors ¬© CARTO',
  subdomains: 'abcd', maxZoom: 19
}).addTo(map);

// Layer groups
const itineraryLayer = L.layerGroup().addTo(map);
const lodgingLayer = L.layerGroup().addTo(map);
const diningLayer = L.layerGroup().addTo(map);

// ‚îÄ‚îÄ REAL DRIVING ROUTES via OSRM ‚îÄ‚îÄ
const driveSegments = [
  { label: "D2 ¬∑ Christchurch ‚Üí Tekapo", color: "#3fb950", weight: 4, waypoints: [[172.6362,-43.5321],[170.4786,-44.0038]] },
  { label: "D4 ¬∑ Tekapo ‚Üí Mt Cook",       color: "#f0883e", weight: 4, waypoints: [[170.4786,-44.0038],[170.0966,-43.7359]] },
  { label: "D6 ¬∑ Mt Cook ‚Üí Gibbston",     color: "#bc8cff", weight: 4, waypoints: [[170.0966,-43.7359],[168.9481,-45.0132]] },
  { label: "D7 ¬∑ Gibbston ‚Üí Queenstown",  color: "#ff7b72", weight: 4, waypoints: [[168.9481,-45.0132],[168.6626,-45.0312]] }
];

async function fetchRoute(waypoints) {
  const coords = waypoints.map(w => w.join(',')).join(';');
  const url = `https://router.project-osrm.org/route/v1/driving/${coords}?overview=full&geometries=geojson`;
  const res = await fetch(url);
  const data = await res.json();
  if (data.routes && data.routes[0]) {
    return data.routes[0].geometry.coordinates.map(c => [c[1], c[0]]);
  }
  return null;
}

const routeStatus = document.createElement('div');
routeStatus.style.cssText = 'position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:rgba(22,27,34,0.9);border:1px solid #30363d;border-radius:20px;padding:6px 14px;font-size:11px;color:#8b949e;z-index:999;transition:opacity 0.3s;';
routeStatus.textContent = 'üõ£Ô∏è Loading driving routes...';
document.body.appendChild(routeStatus);

Promise.all(driveSegments.map(async seg => {
  const coords = await fetchRoute(seg.waypoints);
  if (coords) {
    L.polyline(coords, { color: seg.color, weight: seg.weight, opacity: 0.75, lineJoin: 'round', lineCap: 'round' })
      .bindTooltip(seg.label, { sticky: true, className: 'route-label' }).addTo(map);
  }
})).then(() => {
  routeStatus.style.opacity = '0';
  setTimeout(() => routeStatus.remove(), 400);
}).catch(() => {
  routeStatus.textContent = '‚ö†Ô∏è Route load failed';
  setTimeout(() => routeStatus.remove(), 3000);
});

[{ name:"Ashburton", coords:[-43.9036,171.7280]},{ name:"Methven", coords:[-43.6276,171.6497]},{ name:"Rakaia Gorge", coords:[-43.5800,171.4200]},{ name:"Geraldine", coords:[-44.0978,171.2366]},{ name:"Fairlie", coords:[-44.1022,170.8290]},{ name:"Lake Pukaki", coords:[-44.1772,170.1667]}].forEach(s => {
  L.marker(s.coords, { icon: L.divIcon({ className:'', html:`<div style="width:8px;height:8px;border-radius:50%;background:#3fb950;border:1.5px solid rgba(255,255,255,0.4);opacity:0.7;"></div>`, iconSize:[8,8], iconAnchor:[4,4] })}).bindTooltip(s.name, { direction:'top', offset:[0,-6], className:'route-label' }).addTo(map);
});

[{ name:"Christchurch", coords:[-43.5321,172.6362]},{ name:"Lake Tekapo", coords:[-44.0038,170.4786]},{ name:"Aoraki / Mt Cook", coords:[-43.7359,170.0966]},{ name:"Gibbston Valley", coords:[-45.0132,168.9481]},{ name:"Queenstown", coords:[-45.0312,168.6626]}].forEach(l => {
  L.marker(l.coords, { icon: L.divIcon({ className:'', html:`<div style="background:rgba(22,27,34,0.8);border:1px solid #30363d;border-radius:6px;padding:3px 8px;font-size:11px;font-weight:600;color:#c9d1d9;white-space:nowrap;margin-top:28px;margin-left:-40px;">${l.name}</div>`, iconSize:[0,0] })}).addTo(map);
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ITINERARY MARKERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const locationGroups = {};
days.forEach((day, idx) => {
  const key = `${day.coords[0]},${day.coords[1]}`;
  if (!locationGroups[key]) locationGroups[key] = [];
  locationGroups[key].push({ day, idx });
});

const dayMarkers = new Array(days.length).fill(null);

days.forEach((day, idx) => {
  const size = day.id === 9 ? 32 : 40;
  const icon = L.divIcon({ className:'', html:`<div class="custom-marker" style="width:${size}px;height:${size}px;background:${day.color};font-size:${day.id===9?10:13}px;">${day.id===9?'‚úàÔ∏è':day.id}</div>`, iconSize:[size,size], iconAnchor:[size/2,size/2] });

  const key = `${day.coords[0]},${day.coords[1]}`;
  const group = locationGroups[key];
  const groupIdx = group.findIndex(g => g.idx === idx);
  const offset = (groupIdx - (group.length-1)/2) * 0.008;
  const coords = [day.coords[0]+offset, day.coords[1]];

  const photoHTML = day.photos&&day.photos[0] ? `<div class="popup-photo-wrap"><img src="${day.photos[0]}" alt="${day.location}" loading="lazy"/><div class="popup-meme-overlay">${day.meme}</div></div>` : '';
  const driveHTML = day.drive ? `<div class="drive-badge">üöó ${day.drive}</div>` : '';
  const stayHTML = day.stay ? `<div class="popup-footer">üè† ${day.stay}</div>` : '';
  const popup = `<div class="popup-inner" style="--popup-color:${day.color}">${photoHTML}<div class="popup-badge">${day.label} ¬∑ ${day.date}</div><div class="popup-title">üìç ${day.location}</div>${driveHTML}<ul class="popup-items">${day.activities.map(a=>`<li>${a}</li>`).join('')}</ul>${stayHTML}</div>`;

  const marker = L.marker(coords, { icon }).bindPopup(popup, { maxWidth:300 }).addTo(itineraryLayer);
  marker.on('popupopen', () => {
    document.querySelectorAll('.day-card').forEach(c => c.classList.remove('active'));
    const card = document.getElementById(`day-card-${day.id}`);
    if (card) { card.classList.add('active'); card.scrollIntoView({ behavior:'smooth', block:'nearest' }); }
  });
  dayMarkers[idx] = marker;
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LODGING MARKERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

locations.forEach(loc => {
  loc.lodging.forEach((l, i) => {
    const offset = (i - (loc.lodging.length-1)/2) * 0.003;
    const icon = L.divIcon({ className:'', html:`<div style="width:32px;height:32px;background:${loc.color};border-radius:50%;border:2px solid rgba(255,255,255,0.3);display:flex;align-items:center;justify-content:center;font-size:15px;box-shadow:0 3px 12px rgba(0,0,0,0.5);cursor:pointer;">üè†</div>`, iconSize:[32,32], iconAnchor:[16,16] });
    const popup = `<div class="popup-inner" style="--popup-color:${loc.color}"><div class="popup-badge">üè† ${loc.name}</div><div class="popup-title">${l.name}</div><ul class="popup-items"><li>${l.type}</li><li>üí∞ ${l.costNote}</li><li>üõèÔ∏è ${l.costDetail}</li><li>${l.note.split('.')[0]}.</li></ul></div>`;
    L.marker([l.coords[0]+offset, l.coords[1]], { icon }).bindPopup(popup, { maxWidth:280 }).addTo(lodgingLayer);
  });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DINING MARKERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

locations.forEach(loc => {
  loc.dining.forEach((d, i) => {
    const offset = (i - (loc.dining.length-1)/2) * 0.003;
    const icon = L.divIcon({ className:'', html:`<div style="width:32px;height:32px;background:${loc.color};border-radius:50%;border:2px solid rgba(255,255,255,0.3);display:flex;align-items:center;justify-content:center;font-size:15px;box-shadow:0 3px 12px rgba(0,0,0,0.5);cursor:pointer;">üçΩÔ∏è</div>`, iconSize:[32,32], iconAnchor:[16,16] });
    const popup = `<div class="popup-inner" style="--popup-color:${loc.color}"><div class="popup-badge">üçΩÔ∏è ${loc.name}</div><div class="popup-title">${d.name}</div><ul class="popup-items"><li>${d.type}</li><li>${d.dish}</li><li>${d.vibe}</li></ul></div>`;
    L.marker([d.coords[0]+offset, d.coords[1]], { icon }).bindPopup(popup, { maxWidth:280 }).addTo(diningLayer);
  });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER FUNCTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function renderItinerary() {
  const content = document.getElementById('tab-content');
  content.innerHTML = '';
  days.forEach((day, idx) => {
    const card = document.createElement('div');
    card.className = 'day-card';
    card.id = `day-card-${day.id}`;
    card.style.setProperty('--day-color', day.color);
    card.innerHTML = `
      ${carouselHTML(day.photos, day.location)}
      <div class="day-header">
        <div class="day-badge">${day.id}</div>
        <div class="day-meta">
          <div class="day-label">${day.label}</div>
          <div class="day-date">${day.date}</div>
          <div class="day-location">üìç ${day.location}</div>
        </div>
      </div>
      <div class="day-activities">
        ${day.activities.map(a => `<div class="activity"><span class="dot"></span><span>${a}</span></div>`).join('')}
        ${day.stay ? `<div class="stay-tag">üè† ${day.stay}</div>` : ''}
      </div>
    `;
    card.addEventListener('click', () => {
      document.querySelectorAll('.day-card').forEach(c => c.classList.remove('active'));
      card.classList.add('active');
      map.flyTo(day.coords, 11, { duration: 1.2 });
      if (dayMarkers[idx]) dayMarkers[idx].openPopup();
      if (isMobile()) collapseSheet();
    });
    content.appendChild(card);
  });
  setTimeout(initCarousels,0);
}

function renderLodging() {
  const content = document.getElementById('tab-content');
  content.innerHTML = `<div class="section-header"><span>üè† Accommodation Options</span><span class="updated-tag">Updated ${LAST_UPDATED}</span></div>`;
  locations.forEach(loc => {
    const group = document.createElement('div');
    group.className = 'location-group';
    const dayLabels = loc.days.map(d => { const day = days.find(x => x.id === d); return day ? day.label : ''; }).join(', ');
    group.innerHTML = `
      <div class="location-group-header">
        <div class="location-dot" style="background:${loc.color}"></div>
        <div>
          <div class="location-group-name">${loc.name}</div>
          <div class="location-group-days">${dayLabels}</div>
        </div>
      </div>
      ${loc.lodging.map((l, i) => `
        <div class="lodging-card${l.status === 'booked' ? ' is-booked' : ''}" id="lodging-${loc.id}-${i}">
          ${carouselHTML(l.photos,l.name)}
          ${statusBadge(l.status)}
          <div class="lodging-name">${l.name}</div>
          <div class="lodging-meta">
            <span class="lodging-type">${l.type}</span>
            <span class="lodging-price">${l.price}</span>
          </div>
          <div class="lodging-cost">
            <span class="cost-amount">${l.costNote}</span>
            <span class="cost-detail">${l.costDetail}</span>
          </div>
          <div class="lodging-note">${l.note}</div>
          <div class="card-actions">
            <a href="${l.bookingUrl}" target="_blank" rel="noopener" class="card-btn book">üè® Book</a>
            <a href="${l.mapsUrl}" target="_blank" rel="noopener" class="card-btn maps">üìç Maps</a>
          </div>
        </div>
      `).join('')}
    `;
    content.appendChild(group);
  });
  setTimeout(initCarousels,0);
}

function renderDining() {
  const content = document.getElementById('tab-content');
  content.innerHTML = `<div class="section-header"><span>üçΩÔ∏è Dining Options</span><span class="updated-tag">Bookable restaurants only</span></div>`;
  locations.forEach(loc => {
    const bookableDining = loc.dining.filter(d => d.bookingUrl);
    if (!bookableDining.length) return;
    const group = document.createElement('div');
    group.className = 'location-group';
    const dayLabels = loc.days.map(d => { const day = days.find(x => x.id === d); return day ? day.label : ''; }).join(', ');
    group.innerHTML = `
      <div class="location-group-header">
        <div class="location-dot" style="background:${loc.color}"></div>
        <div>
          <div class="location-group-name">${loc.name}</div>
          <div class="location-group-days">${dayLabels}</div>
        </div>
      </div>
      ${bookableDining.map((d, i) => `
        <div class="dining-card${d.status === 'booked' ? ' is-booked' : ''}" id="dining-${loc.id}-${i}">
          ${carouselHTML(d.photos,d.name)}
          ${statusBadge(d.status)}
          <div class="dining-name">${d.name}</div>
          <div class="dining-meta">
            <span class="dining-type">${d.type}</span>
            ${d.rating ? `<span class="dining-rating">‚≠ê ${d.rating}</span>` : ''}
          </div>
          <div class="dining-dish">${d.dish}</div>
          <div class="dining-vibe">${d.vibe}</div>
          <div class="card-actions">
            <a href="${d.mapsUrl}" target="_blank" rel="noopener" class="card-btn maps">üìç Google Maps</a>
            <a href="${d.bookingUrl}" target="_blank" rel="noopener" class="card-btn book">üìÖ Reserve</a>
          </div>
        </div>
      `).join('')}
    `;
    content.appendChild(group);
  });
  setTimeout(initCarousels,0);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COST TAB
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Cost selections state
const costSelections = {};
locations.forEach(loc => { costSelections[loc.id] = 0; }); // default first option

function calcTotalCost() {
  return locations.reduce((sum, loc) => {
    const sel = costSelections[loc.id] || 0;
    const lodging = loc.lodging[sel];
    return sum + (lodging ? lodging.costPerPP * loc.nights : 0);
  }, 0);
}

function renderCost() {
  const content = document.getElementById('tab-content');
  const minTotal = locations.reduce((s, loc) => s + Math.min(...loc.lodging.map(l => l.costPerPP)) * loc.nights, 0);
  const maxTotal = locations.reduce((s, loc) => s + Math.max(...loc.lodging.map(l => l.costPerPP)) * loc.nights, 0);
  const totalNights = locations.reduce((s, loc) => s + loc.nights, 0);

  content.innerHTML = `
    <div class="section-header"><span>üí∞ Lodging Cost Per Head</span><span class="updated-tag">6 pax</span></div>
    <div class="cost-overview">
      <div class="cost-total-card">
        <div class="cost-total-label">Selected Total / Person</div>
        <div class="cost-total-amount" id="cost-total-display">HK$${calcTotalCost().toLocaleString()}</div>
        <div class="cost-total-nights">${totalNights} nights ¬∑ lodging only</div>
      </div>
      <div class="cost-range">
        <div class="cost-range-item"><div class="r-label">Min possible</div><div class="r-val">HK$${minTotal.toLocaleString()}</div></div>
        <div class="cost-range-item"><div class="r-label">Max possible</div><div class="r-val">HK$${maxTotal.toLocaleString()}</div></div>
        <div class="cost-range-item"><div class="r-label">Avg/night</div><div class="r-val">HK$${Math.round(calcTotalCost()/totalNights).toLocaleString()}</div></div>
      </div>
    </div>
  `;

  locations.forEach(loc => {
    const leg = document.createElement('div');
    leg.className = 'cost-leg';
    const selLodging = loc.lodging[costSelections[loc.id] || 0];
    const legTotal = selLodging ? selLodging.costPerPP * loc.nights : 0;

    leg.innerHTML = `
      <div class="cost-leg-header">
        <div class="cost-leg-left">
          <div class="cost-leg-dot" style="background:${loc.color}"></div>
          <div class="cost-leg-name">${loc.name}</div>
          <div class="cost-leg-nights-tag">${loc.nights}N</div>
        </div>
        <div class="cost-leg-subtotal" id="leg-total-${loc.id}">HK$${legTotal.toLocaleString()}</div>
      </div>
      ${loc.lodging.map((l, i) => `
        <div class="cost-option${(costSelections[loc.id]||0) === i ? ' selected' : ''}" data-loc="${loc.id}" data-idx="${i}">
          <div class="cost-option-row">
            <div class="cost-opt-radio"></div>
            <div class="cost-opt-name">${l.name}</div>
            <div class="cost-opt-ppn">HK$${l.costPerPP}/pp</div>
          </div>
          <div class="cost-opt-total">HK$${(l.costPerPP * loc.nights).toLocaleString()} total for ${loc.nights} night${loc.nights>1?'s':''}<span class="cost-opt-beds">üõèÔ∏è ${l.costDetail}</span></div>
        </div>
      `).join('')}
    `;
    content.appendChild(leg);
  });

  // Bind click events
  content.querySelectorAll('.cost-option').forEach(el => {
    el.addEventListener('click', () => {
      const locId = el.dataset.loc;
      const idx = parseInt(el.dataset.idx);
      costSelections[locId] = idx;
      // Update UI
      content.querySelectorAll(`.cost-option[data-loc="${locId}"]`).forEach((opt, i) => {
        opt.classList.toggle('selected', i === idx);
      });
      const loc = locations.find(l => l.id === locId);
      if (loc) {
        const selLodging = loc.lodging[idx];
        const legTotal = selLodging ? selLodging.costPerPP * loc.nights : 0;
        const legEl = document.getElementById(`leg-total-${locId}`);
        if (legEl) legEl.textContent = 'HK$' + legTotal.toLocaleString();
      }
      // Update grand total + avg/night
      const totalEl = document.getElementById('cost-total-display');
      if (totalEl) totalEl.textContent = 'HK$' + calcTotalCost().toLocaleString();
      // Also update avg/night display (3rd range item)
      const totalNights = locations.reduce((s, l) => s + l.nights, 0);
      const avgEl = content.querySelectorAll('.cost-range-item')[2]?.querySelector('.r-val');
      if (avgEl) avgEl.textContent = 'HK$' + Math.round(calcTotalCost()/totalNights).toLocaleString();
    });
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TAB SWITCHING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

let activeTab = 'itinerary';

function switchTab(tab) {
  activeTab = tab;
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('active');
    if (btn.dataset.tab === tab) btn.classList.add('active');
  });
  if (tab === 'itinerary') renderItinerary();
  else if (tab === 'lodging') renderLodging();
  else if (tab === 'dining') renderDining();
  else if (tab === 'cost') renderCost();
}

document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', (e) => {
    e.stopPropagation();
    switchTab(btn.dataset.tab);
    if (isMobile() && !sidebar.classList.contains('open')) {
      sidebar.classList.add('open');
    }
  });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MOBILE SHEET
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const sidebar = document.getElementById('sidebar');
const handle = document.getElementById('sidebar-handle');
const tabBar = document.getElementById('tab-bar');

function isMobile() { return window.innerWidth <= 640; }

function collapseSheet() {
  sidebar.classList.remove('open');
}

handle.addEventListener('click', () => {
  if (!isMobile()) return;
  sidebar.classList.toggle('open');
});

map.on('click', () => {
  if (isMobile() && sidebar.classList.contains('open')) collapseSheet();
});

// Init
renderItinerary();

setTimeout(() => map.invalidateSize(), 100);
window.addEventListener('resize', () => map.invalidateSize());

</script>
</body>
</html>
